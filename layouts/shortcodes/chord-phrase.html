<form id="chordifyForm">
    </form><input type="text" id="phrase" />
    <button id="chordify" type="submit">Chordify</button>
</form>
<details>
    <summary>Chord Syntax Legend</summary>
    <pre id="legend" class="bold">t = thumb
    i = index
    m = middle
    r = ring
    p = pinky

    mf = metacarpo-flexion
    pf = proximal-flexion
    me = metacarpo-extension</pre>
</details>
<div id="chord-area" class="row col-md-12">
    <div class="col-md-6">
        <h6>Chord strokes</h6>
        <pre id="chordified" class="bold" ></pre>
    </div>
    <div class="col-md-6">
        <div class="row">
        <h6 id="test-timer" class="col-md-10">Test: <span id="timer">0</span> sec</h6>
        <button id="timerHandle" class="col-md-2">X</buttom>
        </div>
        <textarea id="testChord" cols="50" rows="5" ></textarea>
    </div>
</div>
<script type="text/javascript">
    var testChord = document.getElementById('testChord');
    const lambdaUrl = 'https://r2swydpx7syeiycnrnny67bxii0myurm.lambda-url.us-east-1.on.aws/?phrase=';
    var chordified = document.getElementById('chordified');
    var timer = document.getElementById('timer');
    var timerValue = 0;
    var timerHandlet
    var chordify = function() {
        chordified.innerHTML = '';
        var phrase = document.getElementById('phrase').value;
        var chords = fetch(lambdaUrl + phrase)
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                chordified.innerHTML = data;
                return data;
            });
        for (var i = 0; i < chords.length; i++) {
        var chord = chords[i];
        var span = document.createElement('span');
        span.className = 'chord';
        span.innerHTML = chord;
        chordified.appendChild(span);
        }
    };
    var runTimer = function() {
        timerValue++;
        timer.innerHTML = timerValue;
    };
    var startTimer = function() {
        console.log("runTimer", timerValue);
        if(testChord.value.trim().length == 0) {
            clearInterval(timerHandle);
            timer.innerHTML = 0;
            return;
        }
        console.log("testChord:", testChord.value);
        timerHandle = setInterval(runTimer, 1000);
    };
    document.getElementById('chordify')
        .addEventListener('click', chordify);
    document.getElementById('testChord')
        .addEventListener('input', startTimer);
    document.getElementById('timerHandle')
        .addEventListener('click', function() {
            testChord.value = '';
            clearInterval(timerHandle);
            timer.innerHTML = 0;
            timerValue = 0;
    });
</script>